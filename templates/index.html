<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE Scraper</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@4.0.2/dist/timeago.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .btn-search {
            background: linear-gradient(120deg, #28a745, #20c997);
            color: white;
            border-radius: 10px;
            padding: 12px 25px;
            font-weight: 600;
            letter-spacing: 0.5px;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }

        .badge {
            padding: 8px 15px;
            font-weight: 500;
            letter-spacing: 0.5px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        #aiAnalysis {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            border-left: 6px solid #1a73e8;
            margin-bottom: 2rem;
        }

        .text-primary {
            color: #1a73e8 !important;
        }

        .ml-3 {
            margin-left: 1.5rem !important;
        }

        .card {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: none;
        }

        .card-header {
            background: linear-gradient(120deg, #2b4acb, #1a73e8) !important;
            border-bottom: none;
            padding: 2rem !important;
        }

        .card-header h2 {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 0.5rem;
        }

        .input-group {
            background: white;
            border-radius: 15px;
            padding: 0.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        #cveInput {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 1rem;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        #cveInput:focus {
            border-color: #1a73e8;
            box-shadow: 0 0 0 4px rgba(26, 115, 232, 0.1);
        }

        .spinner-border {
            color: #1a73e8;
        }

        #details .card-header {
            background: linear-gradient(120deg, #0dcaf0, #0d6efd) !important;
        }

        .list-unstyled li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .list-unstyled li:last-child {
            border-bottom: none;
        }

        /* Animasiyalƒ± arxa fon */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #f0f4ff 0%, #e0e8ff 100%);
            z-index: -1;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Kart hover effekti */
        .card {
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        .card:hover {
            transform: translateY(-8px);
        }

        /* Axtarƒ±≈ü sah…ôsi √º√ß√ºn fokus effekti */
        .input-group:focus-within {
            box-shadow: 0 8px 25px rgba(26, 115, 232, 0.15);
        }

        /* AI Analiz b√∂lm…ôsi √º√ß√ºn yeni dizayn */
        #aiAnalysis {
            position: relative;
            overflow: hidden;
        }

        #aiAnalysis::before {
            content: 'ü§ñ';
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 24px;
            opacity: 0.1;
        }

        /* Metrik elementl…ôri √º√ß√ºn hover effekti */
        .metric-item {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .metric-item:hover {
            border-left-color: #1a73e8;
            padding-left: 1rem;
            background-color: rgba(26, 115, 232, 0.05);
        }

        /* Badge-l…ôr √º√ß√ºn gradient */
        .badge {
            background-image: linear-gradient(135deg, currentColor, rgba(255,255,255,0.1));
        }

        /* Loading animasiyasƒ± t…ôkmill…ô≈üdirm…ôsi */
        #loading .spinner-border {
            box-shadow: 0 0 15px rgba(26, 115, 232, 0.3);
        }

        /* Severity indikatorlarƒ± √º√ß√ºn pulse effekti */
        .badge[class*="bg-danger"] {
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        /* Referanslar b√∂lm…ôsi √º√ß√ºn hover effekti */
        #references ul li {
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 8px;
        }

        #references ul li:hover {
            background-color: rgba(26, 115, 232, 0.05);
            transform: translateX(10px);
        }

        /* CVE Details kartƒ± √º√ß√ºn x√ºsusi dizayn */
        #details .card-header {
            position: relative;
            overflow: hidden;
        }

        #details .card-header::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 0%, rgba(255,255,255,0.1) 100%);
        }

        /* M…ôtn vurƒüulamalarƒ± √º√ß√ºn gradient */
        .text-primary {
            background: linear-gradient(120deg, #1a73e8, #4285f4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }

        /* C…ôdv…ôl s…ôtirl…ôri √º√ß√ºn hover effekti */
        .table tr {
            transition: all 0.3s ease;
        }

        .table tr:hover {
            background-color: rgba(26, 115, 232, 0.05);
            transform: scale(1.01);
        }

        /* ∆èlav…ô animasiyalar */
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .stats-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border-radius: 12px;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid #1a73e8;
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .metric-visualization {
            height: 200px;
            margin: 1rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .stat-title {
            font-size: 1rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1a73e8;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-item {
            padding: 15px;
            border-left: 3px solid #1a73e8;
            position: relative;
            margin-bottom: 15px;
            background: white;
            border-radius: 0 15px 15px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -9px;
            top: 50%;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #1a73e8;
            transform: translateY(-50%);
        }

        .steps-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .mitigation-step {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: #1a73e8;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Progress bar styles */
        .circular-progress {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            position: relative;
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.2);
        }

        .monitor-panel {
            display: grid;
            gap: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 15px;
        }

        .monitor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .threat-indicator {
            width: 120px;
            height: 30px;
            border-radius: 15px;
            background: linear-gradient(90deg, #4caf50, #ffc107, #f44336);
            position: relative;
        }

        .threat-indicator::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 5px;
            transition: left 0.3s ease;
        }

        .network-graph {
            height: 200px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 10px;
            overflow: hidden;
        }

        .response-guide {
            padding: 1rem;
        }

        .guide-steps {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem;
            scroll-behavior: smooth;
        }

        .guide-step {
            min-width: 200px;
            padding: 1rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .guide-step:hover {
            transform: scale(1.02);
        }

        .guide-progress {
            height: 6px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            margin-top: 1rem;
        }

        .progress-bar {
            height: 100%;
            background: #1a73e8;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .network-impact-container {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
        }

        .impact-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .impact-item {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .impact-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .impact-label {
            display: block;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .impact-value {
            display: block;
            font-size: 1.2rem;
            font-weight: bold;
            color: #1a73e8;
        }

        .network-visualization {
            height: 200px;
            border-radius: 8px;
            background: #f8f9fa;
            position: relative;
            overflow: hidden;
        }

        .node {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #1a73e8;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .node.affected {
            background: #dc3545;
            animation: pulse 1.5s infinite;
        }

        .connection {
            position: absolute;
            height: 2px;
            background: rgba(26, 115, 232, 0.2);
            transform-origin: left center;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="fade-in-up">
    <div class="container mt-5">
        <div class="card">
            <div class="card-header text-white text-center">
                <h2>CVE Information Scraper</h2>
                <small class="text-light">Powered by AI Analysis</small>
            </div>
            <div class="card-body">
                <form id="cveForm">
                    <div class="input-group mb-3">
                        <input type="text" id="cveInput" class="form-control" placeholder="Enter CVE ID (e.g., CVE-2023-1234)" required>
                        <button class="btn btn-search" type="submit">Search</button>
                    </div>
                </form>
                <div id="loading" class="text-center d-none">
                    <div class="spinner-border" role="status"></div>
                    <p>Loading...</p>
                </div>
                <div id="results" class="mt-4"></div>
            </div>
        </div>
        <div id="details" class="mt-4 d-none">
            <div class="card">
                <div class="card-header text-white bg-info d-flex justify-content-between align-items-center">
                    <h4>Details</h4>
                    <span class="badge bg-primary">AI Enhanced</span>
                </div>
                <div class="card-body">
                    <!-- AI Analysis Section -->
                    <div id="aiAnalysis" class="mb-4 border-bottom pb-3">
                        <h5 class="text-primary">AI Analysis</h5>
                        <div id="aiSummary" class="mb-2">
                            <strong>Summary:</strong>
                            <p class="ml-3"></p>
                        </div>
                        
                        <div id="aiTechnical" class="mb-2">
                            <strong>Technical Analysis:</strong>
                            <ul class="list-unstyled ml-3">
                                <li id="vulnType"><strong>Vulnerability Type:</strong> </li>
                                <li id="affectedComponents"><strong>Affected Components:</strong> </li>
                                <li id="attackVector"><strong>Attack Vector:</strong> </li>
                            </ul>
                        </div>

                        <div id="aiRisk" class="mb-2">
                            <strong>Risk Assessment:</strong>
                            <ul class="list-unstyled ml-3">
                                <li id="riskSeverity"><strong>Severity:</strong> <span class="badge"></span></li>
                                <li id="riskComplexity"><strong>Attack Complexity:</strong> </li>
                                <li id="privilegesRequired"><strong>Privileges Required:</strong> </li>
                                <li id="userInteraction"><strong>User Interaction:</strong> </li>
                            </ul>
                        </div>

                        <div id="aiImpact" class="mb-2">
                            <strong>Impact Analysis:</strong>
                            <ul class="list-unstyled ml-3">
                                <li id="impactConfidentiality"><strong>Confidentiality:</strong> </li>
                                <li id="impactIntegrity"><strong>Integrity:</strong> </li>
                                <li id="impactAvailability"><strong>Availability:</strong> </li>
                            </ul>
                        </div>

                        <div id="aiMitigation" class="mb-2">
                            <strong>Mitigation Strategies:</strong>
                            <ul id="mitigationList"></ul>
                        </div>
                    </div>

                    <!-- Existing fields -->
                    <div id="standardDetails">
                        <!-- CVSS Score -->
                        <p id="cvssScore"><strong>CVSS Score:</strong> </p>

                        <!-- Severity -->
                        <p id="severity"><strong>Severity:</strong> </p>

                        <!-- Released -->
                        <p id="released" class="d-none"><strong>Released:</strong> </p>

                        <!-- Last Updated -->
                        <p id="lastUpdated" class="d-none"><strong>Last Updated:</strong> </p>

                        <!-- Vector String -->
                        <p id="vectorString" class="d-none"><strong>Vector String:</strong> </p>

                        <!-- Metrics -->
                        <p id="metrics" class="d-none"><strong>Metrics:</strong> </p>

                        <!-- References -->
                        <div id="references"><strong>References:</strong> <ul></ul></div>

                        <!-- Solutions -->
                        <p id="solutions" class="d-none"><strong>Solutions:</strong> </p>

                        <!-- Tools -->
                        <p id="tools" class="d-none"><strong>Tools:</strong> </p>
                    </div>

                    <!-- New charts section -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="chart-container">
                                <h5 class="text-primary">Impact Analysis Visualization</h5>
                                <canvas id="impactChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-container">
                                <h5 class="text-primary">Risk Assessment Radar</h5>
                                <canvas id="riskRadar"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- New statistics cards -->
                    <div class="row mt-4 mb-4">
                        <div class="col-md-3">
                            <div class="stat-card animate__animated animate__fadeIn">
                                <div class="stat-icon">üîí</div>
                                <h3 class="stat-title">Security Level</h3>
                                <div id="securityMeter" class="stat-value"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card animate__animated animate__fadeIn">
                                <div class="stat-icon">‚ö°</div>
                                <h3 class="stat-title">Attack Complexity</h3>
                                <div id="complexityMeter" class="stat-value"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card animate__animated animate__fadeIn">
                                <div class="stat-icon">üéØ</div>
                                <h3 class="stat-title">Impact Score</h3>
                                <div id="impactMeter" class="stat-value"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card animate__animated animate__fadeIn">
                                <div class="stat-icon">‚è∞</div>
                                <h3 class="stat-title">Time Analysis</h3>
                                <div id="timeAgoValue" class="stat-value"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline -->
                    <div class="timeline-container mt-4">
                        <h5 class="text-primary">Vulnerability Timeline</h5>
                        <div id="vulnerabilityTimeline" class="timeline"></div>
                    </div>

                    <!-- Mitigation Steps -->
                    <div class="mitigation-container mt-4">
                        <h5 class="text-primary">Mitigation Steps</h5>
                        <div id="mitigationSteps" class="steps-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="additional-features mt-4">
        <!-- 3D Threat Visualization -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="feature-card">
                    <h5 class="text-primary">
                        <i class="fas fa-cube"></i> 3D Threat Visualization
                    </h5>
                    <div id="threatVisualization" style="height: 300px;"></div>
                </div>
            </div>
        </div>

        <!-- Real-time Monitoring Panel -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="feature-card">
                    <h5 class="text-primary">
                        <i class="fas fa-shield-alt"></i> Security Monitoring
                    </h5>
                    <div id="securityMonitor" class="monitor-panel">
                        <div class="monitor-item">
                            <span class="monitor-label">Threat Level:</span>
                            <div class="threat-indicator" id="threatLevel"></div>
                        </div>
                        <div class="monitor-item">
                            <span class="monitor-label">Active Exploits:</span>
                            <div class="exploit-counter" id="exploitCounter">0</div>
                        </div>
                        <div class="monitor-item">
                            <span class="monitor-label">Last Scan:</span>
                            <div id="lastScanTime"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="feature-card">
                    <h5 class="text-primary">
                        <i class="fas fa-chart-network"></i> Network Impact Analysis
                    </h5>
                    <div id="networkImpact" class="network-impact-container">
                        <div class="impact-stats">
                            <div class="impact-item">
                                <span class="impact-label">Affected Systems</span>
                                <span class="impact-value" id="affectedSystems">0</span>
                            </div>
                            <div class="impact-item">
                                <span class="impact-label">Risk Level</span>
                                <span class="impact-value" id="riskLevel">-</span>
                            </div>
                            <div class="impact-item">
                                <span class="impact-label">Network Exposure</span>
                                <span class="impact-value" id="networkExposure">-</span>
                            </div>
                        </div>
                        <div class="network-visualization" id="networkVisualization"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Response Guide -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="feature-card">
                    <h5 class="text-primary">
                        <i class="fas fa-tasks"></i> Interactive Response Guide
                    </h5>
                    <div class="response-guide">
                        <div class="guide-steps" id="responseSteps"></div>
                        <div class="guide-progress">
                            <div class="progress-bar" id="guideProgress"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById("cveForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let cveId = document.getElementById("cveInput").value.trim();
            
            // Validate CVE ID format
            if (!/^CVE-\d{4}-\d{4,7}$/.test(cveId)) {
                alert("Invalid CVE format! Please use CVE-YYYY-NNNN");
                return;
            }
            
            document.getElementById("loading").classList.remove("d-none");

            // Fetch CVE data from server
            fetch(`/scrape/${cveId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error fetching CVE data');
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById("loading").classList.add("d-none");
                    let resultDiv = document.getElementById("results");
                    let detailsDiv = document.getElementById("details");

                    if (data && data.success && data.data) {
                        // Handle AI Analysis data
                        if (data.data.ai_analysis) {
                            const aiData = data.data.ai_analysis;
                            
                            // Update Summary
                            if (aiData.summary) {
                                document.querySelector("#aiSummary p").textContent = aiData.summary;
                            }

                            // Update Technical Analysis
                            if (aiData.technical_analysis) {
                                const tech = aiData.technical_analysis;
                                document.querySelector("#vulnType").innerHTML += tech.vulnerability_type || "N/A";
                                document.querySelector("#affectedComponents").innerHTML += tech.affected_components || "N/A";
                                document.querySelector("#attackVector").innerHTML += tech.attack_vector || "N/A";
                            }

                            // Update Risk Assessment
                            if (aiData.risk_assessment) {
                                const risk = aiData.risk_assessment;
                                const severityBadge = document.querySelector("#riskSeverity .badge");
                                severityBadge.textContent = risk.severity || "Unknown";
                                severityBadge.className = `badge bg-${getSeverityClass(risk.severity)}`;
                                
                                document.querySelector("#riskComplexity").innerHTML += risk.complexity || "N/A";
                                document.querySelector("#privilegesRequired").innerHTML += risk.privileges_required || "N/A";
                                document.querySelector("#userInteraction").innerHTML += risk.user_interaction || "N/A";
                            }

                            // Update Impact Analysis
                            if (aiData.impact_analysis) {
                                const impact = aiData.impact_analysis;
                                document.querySelector("#impactConfidentiality").innerHTML += impact.confidentiality || "N/A";
                                document.querySelector("#impactIntegrity").innerHTML += impact.integrity || "N/A";
                                document.querySelector("#impactAvailability").innerHTML += impact.availability || "N/A";
                            }

                            // Update Mitigation Strategies
                            if (aiData.mitigation_strategies) {
                                const mitigationList = document.querySelector("#mitigationList");
                                mitigationList.innerHTML = "";
                                aiData.mitigation_strategies.forEach(strategy => {
                                    const li = document.createElement("li");
                                    li.textContent = strategy;
                                    mitigationList.appendChild(li);
                                });
                            }
                        }

                        // CVSS Score (only numerical value)
                        let cvssScore = data.data.cvss_metrics?.v3?.nist?.base_score || "N/A";
                        let severity = "Unknown";

                        // Determine severity based on CVSS score
                        if (cvssScore !== "N/A") {
                            cvssScore = parseFloat(cvssScore);
                            if (cvssScore >= 9) severity = "Critical";
                            else if (cvssScore >= 7) severity = "High";
                            else if (cvssScore >= 4) severity = "Medium";
                            else severity = "Low";
                        }

                        // Released and Last Updated
                        let released = data.data.cve?.published_date || "No release date available.";
                        let lastUpdated = data.data.cve?.last_modified_date || "No last updated date available.";

                        // Vector String
                        let vectorString = data.data.cvss_metrics?.v3?.nist?.vector || "N/A";

                        // Metrics
                        let metrics = data.data.cvss_metrics?.v3?.nist?.base_score || "N/A";

                        // Solutions and Tools (example data, can be dynamic)
                        let solutions = "Patch the application to the latest version to mitigate this vulnerability.";
                        let tools = "Tools such as Burp Suite and OWASP ZAP can help in identifying and testing for this vulnerability.";

                        // Display CVSS Score (numerical only)
                        document.getElementById("cvssScore").innerHTML = `<strong>CVSS Score:</strong> ${cvssScore !== "N/A" ? cvssScore : "N/A"}`;
                        document.getElementById("severity").innerHTML = `<strong>Severity:</strong> <span class="badge bg-danger">${severity}</span>`;

                        // Check and display Released and Last Updated dates if available
                        if (released !== "No release date available.") {
                            document.getElementById("released").classList.remove("d-none");
                            document.getElementById("released").innerHTML = `<strong>Released:</strong> ${released}`;
                        } else {
                            document.getElementById("released").classList.add("d-none");
                        }

                        if (lastUpdated !== "No last updated date available.") {
                            document.getElementById("lastUpdated").classList.remove("d-none");
                            document.getElementById("lastUpdated").innerHTML = `<strong>Last Updated:</strong> ${lastUpdated}`;
                        } else {
                            document.getElementById("lastUpdated").classList.add("d-none");
                        }

                        // Check and display Vector String if available
                        if (vectorString !== "N/A") {
                            document.getElementById("vectorString").classList.remove("d-none");
                            document.getElementById("vectorString").innerHTML = `<strong>Vector String:</strong> ${vectorString}`;
                        } else {
                            document.getElementById("vectorString").classList.add("d-none");
                        }

                        // Check and display Metrics if available
                        if (metrics !== "N/A") {
                            document.getElementById("metrics").classList.remove("d-none");
                            document.getElementById("metrics").innerHTML = `<strong>Metrics:</strong> ${metrics}`;
                        } else {
                            document.getElementById("metrics").classList.add("d-none");
                        }

                        // Display Solutions and Tools
                        document.getElementById("solutions").classList.remove("d-none");
                        document.getElementById("solutions").innerHTML = `<strong>Solutions:</strong> ${solutions}`;
                        
                        document.getElementById("tools").classList.remove("d-none");
                        document.getElementById("tools").innerHTML = `<strong>Tools:</strong> ${tools}`;

                        // Display custom references
                        let referencesList = document.querySelector("#references ul");
                        referencesList.innerHTML = "";

                        // Add the fixed references
                        const references = [
                            { url: `https://vulmon.com/vulnerabilitydetails?qid=${cveId}`, label: "Vulmon" },
                            { url: `https://vulners.com/search?query=${cveId}`, label: "Vulners" },
                            { url: `https://nvd.nist.gov/vuln/detail/${cveId}`, label: "NIST NVD" }
                        ];

                        references.forEach(ref => {
                            let listItem = document.createElement("li");
                            let link = document.createElement("a");
                            link.href = ref.url;
                            link.target = "_blank";
                            link.innerText = ref.label;
                            listItem.appendChild(link);
                            referencesList.appendChild(listItem);
                        });

                        // Show the details section
                        detailsDiv.classList.remove("d-none");

                        // Create charts
                        createCharts(data.data);

                        // Update statistics cards
                        updateStatCards(data.data);
                        createTimeline(data.data);
                        createMitigationSteps(data.data);
                        updateNetworkImpact(data.data);
                    } else {
                        resultDiv.innerHTML = `<div class='alert alert-danger'>No result found for this CVE</div>`;
                        detailsDiv.classList.add("d-none");
                    }
                })
                .catch(error => {
                    document.getElementById("loading").classList.add("d-none");
                    document.getElementById("results").innerHTML = `<div class='alert alert-danger'>Error fetching data: ${error.message}</div>`;
                });
        });

        // Helper function for severity badge colors
        function getSeverityClass(severity) {
            switch(severity?.toLowerCase()) {
                case 'critical': return 'danger';
                case 'high': return 'warning';
                case 'medium': return 'info';
                case 'low': return 'success';
                default: return 'secondary';
            }
        }

        // Qrafikl…ôri yaratmaq √º√ß√ºn funksiya
        function createCharts(data) {
            // Impact Analysis Chart
            const impactCtx = document.getElementById('impactChart').getContext('2d');
            new Chart(impactCtx, {
                type: 'bar',
                data: {
                    labels: ['Confidentiality', 'Integrity', 'Availability'],
                    datasets: [{
                        label: 'Impact Level',
                        data: [
                            getImpactScore(data.ai_analysis?.impact_analysis?.confidentiality),
                            getImpactScore(data.ai_analysis?.impact_analysis?.integrity),
                            getImpactScore(data.ai_analysis?.impact_analysis?.availability)
                        ],
                        backgroundColor: [
                            'rgba(26, 115, 232, 0.7)',
                            'rgba(66, 133, 244, 0.7)',
                            'rgba(138, 180, 248, 0.7)'
                        ],
                        borderColor: [
                            'rgba(26, 115, 232, 1)',
                            'rgba(66, 133, 244, 1)',
                            'rgba(138, 180, 248, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Risk Assessment Radar Chart
            const riskCtx = document.getElementById('riskRadar').getContext('2d');
            new Chart(riskCtx, {
                type: 'radar',
                data: {
                    labels: ['Severity', 'Complexity', 'Privileges Required', 'User Interaction'],
                    datasets: [{
                        label: 'Risk Factors',
                        data: [
                            getRiskScore(data.ai_analysis?.risk_assessment?.severity),
                            getComplexityScore(data.ai_analysis?.risk_assessment?.complexity),
                            getPrivilegesScore(data.ai_analysis?.risk_assessment?.privileges_required),
                            getInteractionScore(data.ai_analysis?.risk_assessment?.user_interaction)
                        ],
                        backgroundColor: 'rgba(26, 115, 232, 0.2)',
                        borderColor: 'rgba(26, 115, 232, 0.8)',
                        pointBackgroundColor: 'rgba(26, 115, 232, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(26, 115, 232, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });
        }

        // Helper functions for scoring
        function getImpactScore(impact) {
            const scores = {
                'HIGH': 9,
                'MEDIUM': 6,
                'LOW': 3,
                'NONE': 0
            };
            return scores[impact?.toUpperCase()] || 0;
        }

        function getRiskScore(severity) {
            const scores = {
                'CRITICAL': 10,
                'HIGH': 8,
                'MEDIUM': 5,
                'LOW': 2
            };
            return scores[severity?.toUpperCase()] || 0;
        }

        function getComplexityScore(complexity) {
            const scores = {
                'HIGH': 3,
                'MEDIUM': 6,
                'LOW': 9
            };
            return scores[complexity?.toUpperCase()] || 0;
        }

        function getPrivilegesScore(privileges) {
            const scores = {
                'HIGH': 3,
                'LOW': 6,
                'NONE': 9
            };
            return scores[privileges?.toUpperCase()] || 0;
        }

        function getInteractionScore(interaction) {
            const scores = {
                'REQUIRED': 5,
                'NONE': 9
            };
            return scores[interaction?.toUpperCase()] || 0;
        }

        function updateStatCards(data) {
            // Security Level
            const securityScore = calculateSecurityScore(data);
            createCircularProgress('securityMeter', securityScore, '#1a73e8');

            // Complexity
            const complexityScore = calculateComplexityScore(data);
            createCircularProgress('complexityMeter', complexityScore, '#28a745');

            // Impact
            const impactScore = calculateImpactScore(data);
            createCircularProgress('impactMeter', impactScore, '#dc3545');

            // Time Analysis
            if (data.cve?.published_date) {
                const timeAgo = timeago.format(new Date(data.cve.published_date));
                document.getElementById('timeAgoValue').textContent = timeAgo;
            }
        }

        function createCircularProgress(elementId, value, color) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="circular-progress">
                    <svg class="progress-ring" width="80" height="80">
                        <circle class="progress-circle" stroke="${color}" 
                                cx="40" cy="40" r="32" stroke-width="8"
                                style="stroke-dasharray: ${2 * Math.PI * 32}; 
                                       stroke-dashoffset: ${2 * Math.PI * 32 * (1 - value/100)}"/>
                    </svg>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%)">
                        ${value}%
                    </div>
                </div>
            `;
        }

        function createTimeline(data) {
            const timeline = document.getElementById('vulnerabilityTimeline');
            const events = [
                { date: data.cve?.published_date, title: 'Published' },
                { date: data.cve?.last_modified_date, title: 'Last Modified' }
            ];

            timeline.innerHTML = events.map(event => `
                <div class="timeline-item animate__animated animate__fadeInLeft">
                    <div class="timeline-date">${new Date(event.date).toLocaleDateString()}</div>
                    <div class="timeline-title">${event.title}</div>
                </div>
            `).join('');
        }

        function createMitigationSteps(data) {
            const container = document.getElementById('mitigationSteps');
            if (data.ai_analysis?.mitigation_strategies) {
                container.innerHTML = data.ai_analysis.mitigation_strategies.map((step, index) => `
                    <div class="mitigation-step animate__animated animate__fadeInRight">
                        <div class="step-number">${index + 1}</div>
                        <div class="step-content">${step}</div>
                    </div>
                `).join('');
            }
        }

        // Helper functions
        function calculateSecurityScore(data) {
            // Custom security score calculation
            return Math.floor(Math.random() * 30) + 70; // Demo √º√ß√ºn
        }

        function calculateComplexityScore(data) {
            // Custom complexity score calculation
            return Math.floor(Math.random() * 40) + 60; // Demo √º√ß√ºn
        }

        function calculateImpactScore(data) {
            // Custom impact score calculation
            return Math.floor(Math.random() * 50) + 50; // Demo √º√ß√ºn
        }

        // 3D Visualization
        function init3DVisualization() {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer();
            
            renderer.setSize(document.getElementById('threatVisualization').offsetWidth, 300);
            document.getElementById('threatVisualization').appendChild(renderer.domElement);

            // Add 3D objects and animations here
        }

        // Network Impact Visualization
        function initNetworkGraph() {
            const svg = d3.select('#networkImpact')
                .append('svg')
                .attr('width', '100%')
                .attr('height', '100%');
            
            // Add D3.js network visualization here
        }

        // Response Guide
        function initResponseGuide() {
            const steps = [
                'Initial Assessment',
                'Containment',
                'Eradication',
                'Recovery',
                'Lessons Learned'
            ];

            const stepsContainer = document.getElementById('responseSteps');
            steps.forEach((step, index) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'guide-step';
                stepElement.innerHTML = `
                    <h6>${index + 1}. ${step}</h6>
                    <p>Click to view detailed instructions</p>
                `;
                stepsContainer.appendChild(stepElement);
            });
        }

        // Initialize all features
        document.addEventListener('DOMContentLoaded', () => {
            init3DVisualization();
            initNetworkGraph();
            initResponseGuide();

            // Simulate real-time updates
            setInterval(() => {
                document.getElementById('lastScanTime').textContent = 
                    new Date().toLocaleTimeString();
                
                document.getElementById('exploitCounter').textContent = 
                    Math.floor(Math.random() * 10);
                
                const threatLevel = document.getElementById('threatLevel');
                threatLevel.style.setProperty('--position', 
                    Math.random() * 100 + '%');
            }, 3000);
        });

        function updateNetworkImpact(data) {
            // Get risk assessment data from AI analysis
            const riskAssessment = data.ai_analysis?.risk_assessment || {};
            
            // Update affected systems count
            const affectedCount = calculateAffectedSystems(data);
            document.getElementById('affectedSystems').textContent = affectedCount;
            
            // Update risk level
            const riskLevel = riskAssessment.severity || 'UNKNOWN';
            document.getElementById('riskLevel').textContent = riskLevel;
            document.getElementById('riskLevel').className = 'impact-value risk-' + riskLevel.toLowerCase();
            
            // Update network exposure
            const exposure = calculateNetworkExposure(data);
            document.getElementById('networkExposure').textContent = exposure;
            
            // Create network visualization
            createNetworkVisualization(affectedCount, riskLevel);
        }

        function calculateAffectedSystems(data) {
            // Calculate based on vendors and products
            const vendorsAndProducts = data.vendors_and_products || [];
            let count = 0;
            vendorsAndProducts.forEach(vendor => {
                count += vendor.products?.length || 0;
            });
            return count || Math.floor(Math.random() * 10) + 1; // Fallback to random if no data
        }

        function calculateNetworkExposure(data) {
            // Calculate based on attack vector and complexity
            const attackVector = data.ai_analysis?.technical_analysis?.attack_vector || '';
            const complexity = data.ai_analysis?.risk_assessment?.complexity || '';
            
            if (attackVector.toLowerCase().includes('network')) {
                return 'HIGH';
            } else if (complexity.toLowerCase() === 'low') {
                return 'MEDIUM';
            }
            return 'LOW';
        }

        function createNetworkVisualization(nodeCount, riskLevel) {
            const container = document.getElementById('networkVisualization');
            container.innerHTML = ''; // Clear previous visualization
            
            // Create nodes
            for (let i = 0; i < nodeCount; i++) {
                const node = document.createElement('div');
                node.className = 'node' + (Math.random() > 0.5 ? ' affected' : '');
                node.style.left = Math.random() * 90 + '%';
                node.style.top = Math.random() * 90 + '%';
                container.appendChild(node);
                
                // Create connections between nodes
                if (i > 0) {
                    const connection = document.createElement('div');
                    connection.className = 'connection';
                    const prevNode = container.children[i - 1];
                    const x1 = parseFloat(prevNode.style.left);
                    const y1 = parseFloat(prevNode.style.top);
                    const x2 = parseFloat(node.style.left);
                    const y2 = parseFloat(node.style.top);
                    
                    // Calculate connection position and rotation
                    const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                    const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                    
                    connection.style.width = length + '%';
                    connection.style.left = x1 + '%';
                    connection.style.top = y1 + '%';
                    connection.style.transform = `rotate(${angle}deg)`;
                    
                    container.appendChild(connection);
                }
            }
        }
    </script>
</body>
</html>
